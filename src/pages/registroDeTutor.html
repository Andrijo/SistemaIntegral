<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Tutor | SGA</title>
    <link
      rel="shortcut icon"
      href="assets/logos/itch.webp"
      type="image/x-icon" />
    <link rel="stylesheet" href="/src/styles/pages/signup-tutor.css" />
  </head>
  <body>
    <a href="../../index.html" class="back-btn">‚Üê Volver al inicio</a>

    <div class="container">
      <div class="header">
        <div class="user-type-badge">üë®‚Äçüè´ Tutor</div>
        <h1>Crear Cuenta</h1>
        <p>Completa los siguientes datos para registrarte como tutor</p>
      </div>

      <div id="successMessage" class="success-message">
        ¬°Cuenta creada exitosamente! Tu matr√≠cula de tutor ha sido generada.
      </div>

      <div id="errorMessage" class="error-message">
        Error al crear la cuenta. Por favor, verifica los datos.
      </div>

      <form id="registroForm">
        <div class="form-group">
          <label for="nombre">Nombre*</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            required
            minlength="3"
            placeholder="Ingrese su nombre" />
        </div>

        <div class="form-group">
          <label for="email">Correo electr√≥nico *</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="user@example.com" />
        </div>

        <div class="form-group">
          <label for="telefono">Tel√©fono *</label>
          <input
            type="tel"
            id="telefono"
            name="telefono"
            required
            pattern="[0-9]{10}"
            placeholder="10 d√≠gitos" />
        </div>

        <div class="form-group">
          <label for="especialidad">Especialidad *</label>
          <select id="especialidad" name="especialidad" required>
            <option value="">Selecciona tu especialidad</option>
            <option value="matematicas">Matem√°ticas</option>
            <option value="espanol">Espa√±ol</option>
            <option value="ciencias">Ciencias Naturales</option>
            <option value="historia">Historia</option>
            <option value="geografia">Geograf√≠a</option>
            <option value="ingles">Ingl√©s</option>
            <option value="educacion_fisica">Educaci√≥n F√≠sica</option>
            <option value="artes">Artes</option>
            <option value="computacion">Computaci√≥n</option>
            <option value="filosofia">Filosof√≠a</option>
            <option value="quimica">Qu√≠mica</option>
            <option value="fisica">F√≠sica</option>
            <option value="biologia">Biolog√≠a</option>
            <option value="otra">Otra especialidad</option>
          </select>
          <div class="specialization-info">
            üí° Tu especialidad ayudar√° a asignarte las materias adecuadas
          </div>
        </div>

        <div class="form-group">
          <label for="username">Nombre de usuario *</label>
          <input
            type="text"
            id="username"
            name="username"
            required
            minlength="4"
            maxlength="20"
            pattern="[a-zA-Z0-9_]+" />
        </div>

        <div class="form-group">
          <label for="password">Contrase√±a *</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            minlength="6" />
        </div>

        <div class="matricula-preview">
          <div class="label">Matr√≠cula de tutor generada</div>
          <div class="value" id="matriculaPreview">TUT-240001</div>
        </div>

        <div class="date-info">
          üìÖ <strong>Fecha de registro:</strong>
          <span id="fechaRegistro"></span>
        </div>

        <button type="submit" class="submit-btn">Crear Cuenta de Tutor</button>
      </form>

      <div class="login-link">
        <p>¬øYa tienes cuenta? <a href="/index.html">Iniciar sesi√≥n</a></p>
        <p><a href="registroDeAlumno.html">¬øEres alumno? Reg√≠strate aqu√≠</a></p>
      </div>
    </div>

    <script>
      // Variables globales
      let matriculaCounter = 1
      const currentDate = new Date()

      // Formatear fecha
      function formatDate(date) {
        return date.toLocaleDateString("es-ES", {
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        })
      }

      // Generar matr√≠cula de tutor
      function generateMatriculaTutor() {
        const year = currentDate.getFullYear().toString().slice(-2)
        const numero = matriculaCounter.toString().padStart(4, "0")
        return `TUT-${year}${numero}`
      }

      // Actualizar matr√≠cula en tiempo real
      function updateMatricula() {
        const matricula = generateMatriculaTutor()
        document.getElementById("matriculaPreview").textContent = matricula
      }

      // Inicializar p√°gina
      function init() {
        // Mostrar fecha actual
        document.getElementById("fechaRegistro").textContent =
          formatDate(currentDate)

        // Generar matr√≠cula inicial
        updateMatricula()

        // Actualizar contador desde localStorage si existe
        const savedCounter = localStorage.getItem("tutorCounter")
        if (savedCounter) {
          matriculaCounter = parseInt(savedCounter) + 1
          updateMatricula()
        }
      }

      // Validar formulario
      function validateForm(formData) {
        const errors = []

        if (formData.nombre.length < 3) {
          errors.push("El nombre debe tener al menos 3 caracteres")
        }

        if (!formData.email.includes("@")) {
          errors.push("Email inv√°lido")
        }

        if (!/^[0-9]{10}$/.test(formData.telefono)) {
          errors.push("El tel√©fono debe tener 10 d√≠gitos")
        }

        if (!formData.especialidad) {
          errors.push("Debes seleccionar una especialidad")
        }

        if (formData.username.length < 4) {
          errors.push("El nombre de usuario debe tener al menos 4 caracteres")
        }

        if (formData.password.length < 6) {
          errors.push("La contrase√±a debe tener al menos 6 caracteres")
        }

        return errors
      }

      // Mostrar mensajes
      function showMessage(type, message) {
        const successMsg = document.getElementById("successMessage")
        const errorMsg = document.getElementById("errorMessage")

        if (type === "success") {
          successMsg.textContent = message
          successMsg.style.display = "block"
          errorMsg.style.display = "none"
        } else {
          errorMsg.textContent = message
          errorMsg.style.display = "block"
          successMsg.style.display = "none"
        }

        // Scroll hacia arriba para ver el mensaje
        document.querySelector(".container").scrollTop = 0
      }

      // Guardar tutor (simulado - localStorage)
      function saveUser(userData) {
        try {
          // Obtener tutores existentes
          const existingUsers = JSON.parse(
            localStorage.getItem("usuarios_tutores") || "[]"
          )

          // Verificar si el email o username ya existen
          const emailExists = existingUsers.some(
            (user) => user.email === userData.email
          )
          const usernameExists = existingUsers.some(
            (user) => user.username === userData.username
          )

          if (emailExists) {
            throw new Error("El email ya est√° registrado")
          }

          if (usernameExists) {
            throw new Error("El nombre de usuario ya est√° en uso")
          }

          // Agregar nuevo tutor
          existingUsers.push(userData)

          // Guardar en localStorage
          localStorage.setItem(
            "usuarios_tutores",
            JSON.stringify(existingUsers)
          )
          localStorage.setItem("tutorCounter", matriculaCounter)

          return true
        } catch (error) {
          console.error("Error al guardar tutor:", error)
          throw error
        }
      }

      // Obtener nombre de especialidad formateado
      function getEspecialidadName(value) {
        const especialidades = {
          matematicas: "Matem√°ticas",
          espanol: "Espa√±ol",
          ciencias: "Ciencias Naturales",
          historia: "Historia",
          geografia: "Geograf√≠a",
          ingles: "Ingl√©s",
          educacion_fisica: "Educaci√≥n F√≠sica",
          artes: "Artes",
          computacion: "Computaci√≥n",
          filosofia: "Filosof√≠a",
          quimica: "Qu√≠mica",
          fisica: "F√≠sica",
          biologia: "Biolog√≠a",
          otra: "Otra especialidad",
        }
        return especialidades[value] || value
      }

      // Manejar env√≠o del formulario
      document
        .getElementById("registroForm")
        .addEventListener("submit", function (e) {
          e.preventDefault()

          // Obtener datos del formulario
          const formData = {
            nombre: document.getElementById("nombre").value.trim(),
            email: document.getElementById("email").value.trim().toLowerCase(),
            telefono: document.getElementById("telefono").value.trim(),
            especialidad: document.getElementById("especialidad").value,
            especialidadNombre: getEspecialidadName(
              document.getElementById("especialidad").value
            ),
            username: document.getElementById("username").value.trim(),
            password: document.getElementById("password").value,
            matricula: document.getElementById("matriculaPreview").textContent,
            fechaRegistro: currentDate.toISOString(),
            tipoUsuario: "tutor",
          }

          // Validar datos
          const errors = validateForm(formData)
          if (errors.length > 0) {
            showMessage("error", errors.join(". "))
            return
          }

          // Deshabilitar bot√≥n
          const submitBtn = document.querySelector(".submit-btn")
          submitBtn.disabled = true
          submitBtn.textContent = "Creando cuenta..."

          // Simular delay de red
          setTimeout(() => {
            try {
              saveUser(formData)
              showMessage(
                "success",
                `¬°Cuenta de tutor creada exitosamente! Tu matr√≠cula es: ${formData.matricula}. Especialidad: ${formData.especialidadNombre}`
              )

              // Limpiar formulario
              document.getElementById("registroForm").reset()

              // Generar nueva matr√≠cula para el siguiente tutor
              matriculaCounter++
              updateMatricula()

              // Opcional: redirigir despu√©s de 4 segundos
              setTimeout(() => {
                window.location.href = "index.html"
              }, 4000)
            } catch (error) {
              showMessage("error", error.message)
            } finally {
              submitBtn.disabled = false
              submitBtn.textContent = "Crear Cuenta de Tutor"
            }
          }, 1000)
        })

      // Actualizar matr√≠cula cuando cambie el nombre
      document.getElementById("nombre").addEventListener("input", function () {
        if (this.value.trim()) {
          updateMatricula()
        }
      })

      // Inicializar cuando cargue la p√°gina
      document.addEventListener("DOMContentLoaded", init)
    </script>
  </body>
</html>
